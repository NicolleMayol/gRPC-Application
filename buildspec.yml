version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.8
    commands:
      # Install protoc compiler
      - sudo apt-get update
      - sudo apt-get install -y protobuf-compiler

  pre_build:
    commands:
      # Compile proto file
      - python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. ./app/crypto_service.proto

  build:
    commands:
      # Install dependencies
      - pip install -r ./app/requirements.txt

  post_build:
    commands:
      # Update client configuration file with server IP address
      - sed -i 's/YOUR_SERVER_ADDRESS/your_server_ip_or_dns/g' crypto_client.py
      # Run the gRPC client
      - python ./app/crypto_client.py
